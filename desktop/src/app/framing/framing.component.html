<div class="grid px-4 py-2 mt-1">
	<div class="col-6">
		<p-floatLabel>
			<input
				pInputText
				class="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.rightAscension"
				(ngModelChange)="savePreference()" />
			<label>RA (J2000)</label>
		</p-floatLabel>
	</div>
	<div class="col-6">
		<p-floatLabel>
			<input
				pInputText
				class="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.declination"
				(ngModelChange)="savePreference()" />
			<label>DEC (J2000)</label>
		</p-floatLabel>
	</div>
	<div class="col-6">
		<p-floatLabel>
			<p-inputNumber
				[min]="1"
				[max]="7680"
				class="w-full"
				[showButtons]="true"
				styleClass="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.width"
				(ngModelChange)="savePreference(); computeFOV()"
				locale="en"
				spinnableNumber />
			<label>Width</label>
		</p-floatLabel>
	</div>
	<div class="col-6">
		<p-floatLabel>
			<p-inputNumber
				[min]="1"
				[max]="4320"
				class="w-full"
				[showButtons]="true"
				styleClass="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.height"
				(ngModelChange)="savePreference(); computeFOV()"
				locale="en"
				spinnableNumber />
			<label>Height</label>
		</p-floatLabel>
	</div>
	<div class="col-6 flex-row gap-1">
		<p-floatLabel>
			<p-inputNumber
				[min]="0.1"
				[max]="90"
				[step]="0.1"
				class="w-full"
				[showButtons]="true"
				styleClass="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.fov"
				(ngModelChange)="savePreference()"
				locale="en"
				mode="decimal"
				[minFractionDigits]="1"
				spinnableNumber />
			<label>FOV (°)</label>
		</p-floatLabel>
		<p-button
			[text]="true"
			[rounded]="true"
			icon="mdi mdi-calculator"
			size="small"
			(onClick)="fov.showDialog = true"
			pTooltip="Calculate"
			tooltipPosition="bottom" />
	</div>
	<div class="col-6">
		<p-floatLabel>
			<p-inputNumber
				[min]="-360"
				[max]="360"
				[step]="0.1"
				class="w-full"
				[showButtons]="true"
				styleClass="p-inputtext-sm border-0 w-full"
				[(ngModel)]="preference.rotation"
				(ngModelChange)="savePreference()"
				locale="en"
				mode="decimal"
				[minFractionDigits]="1"
				spinnableNumber />
			<label>Rotation (°)</label>
		</p-floatLabel>
	</div>
	<div class="col-12">
		<p-floatLabel class="w-full">
			<p-dropdown
				[options]="hipsSurveys"
				[(ngModel)]="preference.hipsSurvey"
				(ngModelChange)="savePreference()"
				styleClass="border-0"
				emptyMessage="No HiPS survey found"
				[autoDisplayFirst]="false">
				<ng-template
					let-item
					pTemplate="selectedItem">
					<div class="flex flex-column">
						<span class="text-xs">{{ item?.regime }} ({{ item?.skyFraction | percent: '1.1-1' }})</span>
						<span>{{ item?.id }}</span>
					</div>
				</ng-template>
				<ng-template
					let-item
					pTemplate="item">
					<div class="flex flex-column">
						<span class="text-xs">{{ item.regime }} ({{ item?.skyFraction | percent: '1.1-1' }})</span>
						<span>{{ item.id }}</span>
					</div>
				</ng-template>
			</p-dropdown>
			<label>HiPS Survey</label>
		</p-floatLabel>
	</div>
	<div class="col-12 justify-content-center mt-2">
		<p-button
			[disabled]="!preference.hipsSurvey || loading"
			icon="mdi mdi-download"
			label="Load"
			(onClick)="frame()"
			[text]="true"
			size="small" />
	</div>
	<div class="col-12 justify-content-center">
		<span class="text-sm text-gray-500">
			Made use of
			<a
				target="_blank"
				href="https://alasky.cds.unistra.fr/hips-image-services/hips2fits">
				hips2fits
			</a>
			, a service provided by CDS.
		</span>
	</div>
</div>

<p-dialog
	header="FOV"
	[draggable]="false"
	[(visible)]="fov.showDialog"
	[modal]="false"
	[style]="{ width: '80vw' }">
	<div class="grid mt-1">
		<div class="col-12 flex-column gap-3">
			<p-floatLabel>
				<p-inputNumber
					[min]="0"
					[max]="10000"
					styleClass="p-inputtext-sm border-0 w-full"
					[showButtons]="true"
					[(ngModel)]="preference.focalLength"
					[allowEmpty]="false"
					locale="en"
					(ngModelChange)="computeFOV(false)"
					spinnableNumber />
				<label>Focal length (mm)</label>
			</p-floatLabel>
			<p-floatLabel class="w-full">
				<p-inputNumber
					[min]="0"
					[max]="100"
					[step]="0.01"
					[minFractionDigits]="1"
					styleClass="p-inputtext-sm border-0 w-full"
					[showButtons]="true"
					[(ngModel)]="preference.pixelSize"
					[allowEmpty]="false"
					locale="en"
					mode="decimal"
					(ngModelChange)="computeFOV(false)"
					spinnableNumber />
				<label>Pixel size (µm)</label>
			</p-floatLabel>
			<p-checkbox
				[binary]="true"
				[(ngModel)]="preference.updateFovOnChange"
				label="Update FOV on width/height change"
				(ngModelChange)="savePreference()" />
		</div>
	</div>
	<ng-template pTemplate="footer">
		<div class="w-full flex justify-content-between align-items-center">
			<span class="flex-1 text-center font-bold text-lg">{{ fov.computed.toFixed(3) }}°</span>
			<p-button
				[text]="true"
				icon="mdi mdi-check"
				label="OK"
				size="small"
				(onClick)="computeFOV(true)" />
		</div>
	</ng-template>
</p-dialog>
