<div class="grid px-4 py-2 mt-1">
	<div class="col-6">
		<neb-input-text
			label="RA (J2000)"
			[(value)]="preference.rightAscension"
			(valueChange)="savePreference()" />
	</div>
	<div class="col-6">
		<neb-input-text
			label="DEC (J2000)"
			[(value)]="preference.declination"
			(valueChange)="savePreference()" />
	</div>
	<div class="col-6">
		<neb-input-number
			label="Width"
			[min]="1"
			[max]="7680"
			[(value)]="preference.width"
			(valueChange)="savePreference(); computeFOV()" />
	</div>
	<div class="col-6">
		<neb-input-number
			label="Height"
			[min]="1"
			[max]="4320"
			[(value)]="preference.height"
			(valueChange)="savePreference(); computeFOV()" />
	</div>
	<div class="col-6 flex-row gap-1">
		<neb-input-number
			label="FOV (°)"
			[min]="0.1"
			[max]="90"
			[step]="0.1"
			[(value)]="preference.fov"
			(valueChange)="savePreference()" />
		<neb-button
			icon="mdi mdi-calculator"
			(action)="fov.showDialog = true"
			tooltip="Calculate" />
	</div>
	<div class="col-6">
		<neb-input-number
			label="Rotation (°)"
			[min]="-360"
			[max]="360"
			[step]="0.1"
			[(value)]="preference.rotation"
			(valueChange)="savePreference()" />
	</div>
	<div class="col-12">
		<ng-template
			#hipsSurveyDropdownItem
			let-item>
			<div class="flex flex-column">
				<span class="text-xs">{{ item?.regime }} ({{ item?.skyFraction | percent: '1.1-1' }})</span>
				<span>{{ item?.id }}</span>
			</div>
		</ng-template>
		<neb-dropdown
			label="HiPS Survey"
			[options]="hipsSurveys"
			[filter]="true"
			[filterFields]="['id', 'category', 'frame', 'regime']"
			[(value)]="preference.hipsSurvey"
			(valueChange)="savePreference()"
			emptyMessage="No HiPS survey available"
			[itemTemplate]="hipsSurveyDropdownItem" />
	</div>
	<div class="col-12 justify-content-center mt-2">
		<neb-button
			[disabled]="!preference.hipsSurvey || loading"
			icon="mdi mdi-download"
			label="Load"
			(action)="frame()" />
	</div>
	<div class="col-12 justify-content-center">
		<span class="text-sm text-gray-500">
			Made use of
			<a
				target="_blank"
				href="https://alasky.cds.unistra.fr/hips-image-services/hips2fits">
				hips2fits
			</a>
			, a service provided by CDS.
		</span>
	</div>
</div>

<p-dialog
	header="FOV"
	[draggable]="false"
	[(visible)]="fov.showDialog"
	[modal]="false"
	[style]="{ width: '80vw' }">
	<div class="grid mt-1">
		<div class="col-12 flex-column gap-3">
			<neb-input-number
				label="Focal length (mm)"
				[min]="0"
				[max]="10000"
				[(value)]="preference.focalLength"
				(valueChange)="computeFOV(false)" />
			<neb-input-number
				label="Pixel size (µm)"
				[min]="0"
				[max]="100"
				[step]="0.01"
				[fractionDigits]="2"
				[(value)]="preference.pixelSize"
				(valueChange)="computeFOV(false)" />
			<neb-checkbox
				label="Update FOV on width/height change"
				[(value)]="preference.updateFovOnChange"
				(valueChange)="savePreference()" />
		</div>
	</div>
	<ng-template pTemplate="footer">
		<div class="w-full flex justify-content-between align-items-center">
			<span class="flex-1 text-center font-bold text-lg">{{ fov.computed.toFixed(3) }}°</span>
			<neb-button
				icon="mdi mdi-check"
				label="OK"
				(action)="computeFOV(true)" />
		</div>
	</ng-template>
</p-dialog>
