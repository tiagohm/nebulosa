<div class="container px-4 py-3">
    <div class="grid">
        <div class="col-6 align-items-center gap-2">
            <span class="p-float-label device">
                <p-dropdown [disabled]="running" [options]="cameras" [(ngModel)]="camera" optionLabel="name"
                            (ngModelChange)="cameraChanged()" styleClass="p-inputtext-sm border-0 max-w-full" emptyMessage="No camera found" />
                <label>Camera</label>
            </span>
            <p-button [disabled]="!camera.name || running" icon="mdi mdi-cog" (onClick)="showCameraDialog()" size="small" />
        </div>
        <div class="col-6 align-items-center gap-2" *ngIf="tab === 0">
            <span class="p-float-label device">
                <p-dropdown [disabled]="running" [options]="mounts" [(ngModel)]="mount" optionLabel="name"
                            (ngModelChange)="mountChanged()" styleClass="p-inputtext-sm border-0 max-w-full" emptyMessage="No mount found" />
                <label>Mount</label>
            </span>
            <p-button *ngIf="mount.connected" [disabled]="!mount || running" (onClick)="mountConnect()" icon="mdi mdi-close"
                      size="small" severity="danger" pTooltip="Disconnect" tooltipPosition="bottom" />
            <p-button *ngIf="!mount.connected" [disabled]="!mount || running" (onClick)="mountConnect()" icon="mdi mdi-connection"
                      size="small" severity="info" pTooltip="Connect" tooltipPosition="bottom" />
        </div>
        <div class="col-6 align-items-center gap-2" *ngIf="tab === 1">
            <span class="p-float-label device">
                <p-dropdown [disabled]="running" [options]="guideOutputs" [(ngModel)]="guideOutput" optionLabel="name"
                            (ngModelChange)="guideOutputChanged()" styleClass="p-inputtext-sm border-0 max-w-full"
                            emptyMessage="No guide output found" />
                <label>Guide Output</label>
            </span>
            <p-button *ngIf="guideOutput.connected" [disabled]="!guideOutput || running" (onClick)="guideOutputConnect()"
                      icon="mdi mdi-close" size="small" severity="danger" pTooltip="Disconnect" tooltipPosition="bottom" />
            <p-button *ngIf="!guideOutput.connected" [disabled]="!guideOutput || running" (onClick)="guideOutputConnect()"
                      icon="mdi mdi-connection" size="small" severity="info" pTooltip="Connect" tooltipPosition="bottom" />
        </div>
        <div class="col-12 pt-0 text-sm text-gray-400 flex align-items-center my-1 gap-1 text-sm" style="min-height: 25px;">
            <i class="mdi mdi-information text-blue-600"></i>
            <span style="min-width: 60px" class="text-left mr-2">{{ status | enum | lowercase }}</span>
            <ng-container *ngIf="running && alignmentMethod === 'DARV'">
                <span *ngIf="darvDirection" class="bg-purple-500 border-round-sm px-1 text-center text-sm text-gray-900" style="min-width: 44px">
                    {{ darvDirection }}
                </span>
                <span class="bg-green-500 border-round-sm px-1 text-center text-sm text-gray-900" style="min-width: 50px">
                    {{ remainingTime | exposureTime }}
                </span>
                <span class="bg-green-500 border-round-sm px-1 text-center text-sm text-gray-900" style="min-width: 40px">
                    {{ progress | percent:'1.1-1' }}
                </span>
            </ng-container>
            <ng-container *ngIf="running && alignmentMethod === 'TPPA'">
                <span class="bg-green-500 border-round-sm px-1 text-center text-sm text-gray-900" style="min-width: 50px">
                    {{ elapsedTime | exposureTime }}
                </span>
                <span *ngIf="status === 'SLEWING' || status === 'SOLVED'" class="bg-blue-500 border-round-sm px-1 text-center text-sm text-gray-900"
                      style="min-width: 60px">
                    {{ tppaRightAscension }}
                </span>
                <span *ngIf="status === 'SLEWING' || status === 'SOLVED'" class="bg-blue-600 border-round-sm px-1 text-center text-sm text-gray-900"
                      style="min-width: 60px">
                    {{ tppaDeclination }}
                </span>
            </ng-container>
        </div>
    </div>
    <div class="grid">
        <div class="col-12">
            <p-tabView [(activeIndex)]="tab">
                <p-tabPanel header="TPPA">
                    <div class="grid mt-3">
                        <div class="col-5 gap-2 align-items-center">
                            <span class="p-float-label">
                                <p-dropdown [options]="plateSolverTypes" [(ngModel)]="tppaRequest.plateSolver.type" [autoDisplayFirst]="false"
                                            styleClass="p-inputtext-sm border-0" (ngModelChange)="plateSolverChanged()" />
                                <label>Plate Solver</label>
                            </span>
                        </div>
                        <div class="col-5 align-items-center">
                            <span class="p-float-label">
                                <p-inputNumber styleClass="p-inputtext-sm border-0 max-w-full" [(ngModel)]="tppaRequest.stepDistance"
                                               [showButtons]="true" [min]="1" [max]="15" (ngModelChange)="savePreference()" />
                                <label>Step distance (Â°)</label>
                            </span>
                        </div>
                        <div class="col-2 flex flex-column align-items-center justify-content-start text-center gap-2">
                            <span class="text-sm text-gray-100">East</span>
                            <p-inputSwitch [(ngModel)]="tppaRequest.eastDirection" (ngModelChange)="savePreference()" />
                        </div>
                        <div class="col-6 flex align-items-center justify-content-center text-center gap-2 text-sm">
                            <p-checkbox [binary]="true" [(ngModel)]="tppaRequest.stopTrackingWhenDone" label="Stop tracking when done"
                                        (ngModelChange)="savePreference()" />
                        </div>
                        <div class="col-6 flex align-items-center justify-content-center text-center gap-2 text-sm">
                            <p-checkbox [binary]="true" [(ngModel)]="tppaRequest.compensateRefraction" label="Compensate refraction"
                                        (ngModelChange)="savePreference()" />
                        </div>
                    </div>
                    <div class="grid mt-2">
                        <div class="col-4 flex flex-column align-items-center justify-content-center">
                            <span>Azimuth</span>
                            <span>{{ tppaAzimuthError }}</span>
                            <span>{{ tppaAzimuthErrorDirection }}</span>
                        </div>
                        <div class="col-4 flex flex-column align-items-center justify-content-center">
                            <span>Altitude</span>
                            <span>{{ tppaAltitudeError }}</span>
                            <span>{{ tppaAltitudeErrorDirection }}</span>
                        </div>
                        <div class="col-4 flex flex-column align-items-center justify-content-center">
                            <span>Total</span>
                            <span>{{ tppaTotalError }}</span>
                        </div>
                    </div>
                    <div class="grid mt-2">
                        <div class="col-12 flex align-items-center justify-content-center gap-1">
                            <p-button [disabled]="!camera.connected || !mount.connected || mount.parked || mount.parking || mount.slewing || running"
                                      label="Start" (onClick)="tppaStart()" icon="mdi mdi-play" severity="success" size="small" />
                            <p-button [disabled]="!camera.connected || !mount.connected || !running || status === 'PAUSING'"
                                      *ngIf="status !== 'PAUSED'" label="Pause" (onClick)="tppaPause()" icon="mdi mdi-pause" severity="info"
                                      size="small" />
                            <p-button [disabled]="!camera.connected || !mount.connected || !running"
                                      *ngIf="status === 'PAUSED'" label="Unpause" (onClick)="tppaUnpause()" icon="mdi mdi-play" severity="info"
                                      size="small" />
                            <p-button [disabled]="!camera.connected || !mount.connected || !running" label="Abort" (onClick)="tppaStop()"
                                      icon="mdi mdi-stop" severity="danger" size="small" />
                            <p-button [disabled]="!camera.connected" (onClick)="openCameraImage()" icon="mdi mdi-image" [text]="true"
                                      styleClass="ml-4" pTooltip="View image" tooltipPosition="bottom" size="small" />
                        </div>
                    </div>
                </p-tabPanel>
                <p-tabPanel header="DARV">
                    <div class="grid mt-3">
                        <div class="col-4">
                            <span class="p-float-label">
                                <p-inputNumber styleClass="p-inputtext-sm border-0 max-w-full" [(ngModel)]="darvRequest.initialPause"
                                               [showButtons]="true" [min]="1" [max]="60" (ngModelChange)="initialPauseChanged()" />
                                <label>Initial pause (s)</label>
                            </span>
                        </div>
                        <div class="col-4">
                            <span class="p-float-label">
                                <p-inputNumber styleClass="p-inputtext-sm border-0 max-w-full" [(ngModel)]="darvRequest.exposureTime"
                                               [showButtons]="true" [min]="1" [max]="600" (ngModelChange)="driftForChanged()" />
                                <label>Drift for (s)</label>
                            </span>
                        </div>
                        <div class="col-4">
                            <span class="p-float-label">
                                <p-dropdown [options]="darvHemispheres" [(ngModel)]="darvHemisphere" styleClass="p-inputtext-sm border-0"
                                            [autoDisplayFirst]="false" />
                                <label>Hemisphere</label>
                            </span>
                        </div>
                    </div>
                    <div class="grid mt-2">
                        <div class="col-12 flex align-items-center justify-content-center gap-1">
                            <p-button [disabled]="!camera.connected || !guideOutput.connected || running" label="Start" (onClick)="darvStart()"
                                      icon="mdi mdi-play" severity="success" size="small" />
                            <p-button [disabled]="!camera.connected || !guideOutput.connected || !running" label="Abort" (onClick)="darvStop()"
                                      icon="mdi mdi-stop" severity="danger" size="small" />
                            <p-button [disabled]="!camera.connected" (onClick)="openCameraImage()" icon="mdi mdi-image" [text]="true"
                                      styleClass="ml-4" pTooltip="View image" tooltipPosition="bottom" size="small" />
                        </div>
                    </div>
                </p-tabPanel>
            </p-tabView>
        </div>
    </div>
</div>