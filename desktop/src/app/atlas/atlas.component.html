<div class="grid flex-1">
    <div class="col-12">
        <p-tabView [(activeIndex)]="tab" (activeIndexChange)="tabChanged()" class="main-tabs">
            <p-tabPanel header="Sun" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Sun" tooltipPosition="bottom">
                        <img src="assets/icons/sun.png">
                    </div>
                </ng-template>
                <div class="grid flex flex-column align-items-center justify-content-center" style="height: 206px;">
                    <img #imageOfSun style="width: 191px">
                    <a class="text-sm" target="_blank" href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_HMIIC.jpg">SDO/HMI</a>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Moon" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Moon" tooltipPosition="bottom">
                        <img src="assets/icons/moon.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center" style="height: 206px;">
                    <p-moon [width]="187" [height]="187" [illuminationRatio]="moonIlluminated" [waning]="moonWaning" />
                </div>
            </p-tabPanel>
            <p-tabPanel header="Planets" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Planets" tooltipPosition="bottom">
                        <img src="assets/icons/jupiter.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <p-table [value]="planets" class="planet" [(selection)]="planet" (selectionChange)="planetChanged()" selectionMode="single"
                             dataKey="code"
                             styleClass="p-datatable-striped">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr [pSelectableRow]="item">
                                <td>{{ item.name }}</td>
                                <td>{{ item.type }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Minor Planets" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Minor planets" tooltipPosition="bottom">
                        <img src="assets/icons/asteroid.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <div class="col-9">
                        <span class="p-float-label">
                            <input type="text" pInputText class="p-inputtext-sm border-0 w-full" [(ngModel)]="minorPlanetSearchText"
                                   pTooltip="Enter the IAU number, designation, name or SPK-ID for the object of interest."
                                   tooltipPosition="bottom" />
                            <label>Search</label>
                        </span>
                    </div>
                    <div class="col-3">
                        <p-button [disabled]="minorPlanetSearchText.length < 3 || refreshing" (onClick)="searchMinorPlanet()" icon="mdi mdi-magnify"
                                  severity="success" size="small" />
                    </div>
                </div>
                <div class="grid flex align-items-center justify-content-center mt-2">
                    <p-table [value]="minorPlanet?.parameters ?? []" class="minorPlanet" styleClass="p-datatable-striped">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Value</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr>
                                <td>{{ item.name }}</td>
                                <td>{{ item.description }}</td>
                                <td>{{ item.value }} {{ item.unit }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Stars" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Stars" tooltipPosition="bottom">
                        <img src="assets/icons/stars.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <div class="col-9">
                        <span class="p-float-label">
                            <input type="text" pInputText class="p-inputtext-sm border-0 w-full" [(ngModel)]="starSearchText" />
                            <label>Search</label>
                        </span>
                    </div>
                    <div class="col-3 flex align-items-center gap-1">
                        <p-button [disabled]="refreshing" (onClick)="searchStar()" icon="mdi mdi-magnify" severity="info" size="small" />
                        <p-button [disabled]="refreshing" (onClick)="showStarFilterDialog()" icon="mdi mdi-filter" size="small" />
                    </div>
                </div>
                <div class="grid flex align-items-center justify-content-center mt-2">
                    <p-table [value]="starItems" class="star" sortField="magnitude" [(selection)]="star" (selectionChange)="starChanged()"
                             selectionMode="single" dataKey="id" styleClass="p-datatable-striped" [paginator]="true" [rows]="100"
                             [pageLinks]="3" [showCurrentPageReport]="true" currentPageReportTemplate="{first}-{last} / {totalRecords}">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 40%" pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                                <th style="width: 25%" pSortableColumn="type">Type <p-sortIcon field="type" /></th>
                                <th style="width: 15%" pSortableColumn="magnitude">Mag. <p-sortIcon field="magnitude" /></th>
                                <th style="width: 20%" pSortableColumn="constellation">Const. <p-sortIcon field="constellation" /></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr [pSelectableRow]="item">
                                <td class="text-sm">{{ item | skyObject:'name' }}</td>
                                <td class="text-sm">{{ item.type | enum }}</td>
                                <td class="text-sm text-center">{{ item.magnitude < 99 ? item.magnitude.toFixed(1) : '-' }}</td>
                                <td class="text-sm text-center">{{ item.constellation }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="DSOs" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="DSOs" tooltipPosition="bottom">
                        <img src="assets/icons/milky-way.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <div class="col-9">
                        <span class="p-float-label">
                            <input type="text" pInputText class="p-inputtext-sm border-0 w-full" [(ngModel)]="dsoSearchText" />
                            <label>Search</label>
                        </span>
                    </div>
                    <div class="col-3 flex align-items-center gap-1">
                        <p-button [disabled]="refreshing" (onClick)="searchDSO()" icon="mdi mdi-magnify" size="small" severity="info" />
                        <p-button [disabled]="refreshing" (onClick)="showDSOFilterDialog()" icon="mdi mdi-filter" size="small" />
                    </div>
                </div>
                <div class="grid flex align-items-center justify-content-center mt-2">
                    <p-table [value]="dsoItems" class="dso" sortField="magnitude" [(selection)]="dso" (selectionChange)="dsoChanged()"
                             selectionMode="single" dataKey="id" styleClass="p-datatable-striped" [paginator]="true" [rows]="100"
                             [pageLinks]="3" [showCurrentPageReport]="true" currentPageReportTemplate="{first}-{last} / {totalRecords}">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 40%" pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                                <th style="width: 25%" pSortableColumn="type">Type <p-sortIcon field="type" /></th>
                                <th style="width: 15%" pSortableColumn="magnitude">Mag. <p-sortIcon field="magnitude" /></th>
                                <th style="width: 20%" pSortableColumn="constellation">Const. <p-sortIcon field="constellation" /></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr [pSelectableRow]="item">
                                <td class="text-sm">{{ item | skyObject:'name' }}</td>
                                <td class="text-sm">{{ item.type | enum }}</td>
                                <td class="text-sm text-center">{{ item.magnitude < 99 ? item.magnitude.toFixed(1) : '-' }}</td>
                                <td class="text-sm text-center">{{ item.constellation }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="Simbad" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Simbad" tooltipPosition="bottom">
                        <img src="assets/icons/online-search.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <div class="col-9">
                        <span class="p-float-label">
                            <input type="text" pInputText class="p-inputtext-sm border-0 w-full" [(ngModel)]="simbadSearchText" />
                            <label>Search</label>
                        </span>
                    </div>
                    <div class="col-3 flex align-items-center gap-1">
                        <p-button [disabled]="refreshing" (onClick)="searchSimbad()" icon="mdi mdi-magnify" size="small" severity="info" />
                        <p-button [disabled]="refreshing" (onClick)="showSimbadFilterDialog()" icon="mdi mdi-filter" size="small" />
                    </div>
                </div>
                <div class="grid flex align-items-center justify-content-center mt-2">
                    <p-table [value]="simbadItems" class="simbad" sortField="magnitude" [(selection)]="simbad" (selectionChange)="simbadChanged()"
                             selectionMode="single" dataKey="id" styleClass="p-datatable-striped" [paginator]="true" [rows]="100"
                             [pageLinks]="3" [showCurrentPageReport]="true" currentPageReportTemplate="{first}-{last} / {totalRecords}">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 40%" pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                                <th style="width: 25%" pSortableColumn="type">Type <p-sortIcon field="type" /></th>
                                <th style="width: 15%" pSortableColumn="magnitude">Mag. <p-sortIcon field="magnitude" /></th>
                                <th style="width: 20%" pSortableColumn="constellation">Const. <p-sortIcon field="constellation" /></th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr [pSelectableRow]="item">
                                <td class="text-sm">{{ item | skyObject:'name' }}</td>
                                <td class="text-sm">{{ item.type | enum }}</td>
                                <td class="text-sm text-center">{{ item.magnitude < 99 ? item.magnitude.toFixed(1) : '-' }}</td>
                                <td class="text-sm text-center">{{ item.constellation }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
            <p-tabPanel header="TLEs" [disabled]="refreshing">
                <ng-template pTemplate="header">
                    <div class="p-3" pTooltip="Satellites" tooltipPosition="bottom">
                        <img src="assets/icons/satellite.png">
                    </div>
                </ng-template>
                <div class="grid flex align-items-center justify-content-center">
                    <div class="col-9">
                        <span class="p-float-label">
                            <input type="text" pInputText class="p-inputtext-sm border-0 w-full" [(ngModel)]="satelliteSearchText" />
                            <label>Search</label>
                        </span>
                    </div>
                    <div class="col-3 flex align-items-center gap-1">
                        <p-button [disabled]="refreshing" (onClick)="searchSatellite()" icon="mdi mdi-magnify"
                                  size="small" severity="info" />
                        <p-button [disabled]="refreshing" (onClick)="showSatelliteFilterDialog = true" icon="mdi mdi-filter"
                                  size="small" />
                    </div>
                </div>
                <div class="grid flex align-items-center justify-content-center mt-2">
                    <p-table [value]="satelliteItems" class="satellite" sortField="name" [(selection)]="satellite"
                             (selectionChange)="satelliteChanged()"
                             selectionMode="single" dataKey="id" styleClass="p-datatable-striped" [paginator]="true" [rows]="100"
                             [pageLinks]="3" [showCurrentPageReport]="true" currentPageReportTemplate="{first}-{last} / {totalRecords}">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: 20%" pSortableColumn="id">NORAD ID<p-sortIcon field="id" /></th>
                                <th style="width: 40%" pSortableColumn="name">Name <p-sortIcon field="name" /></th>
                                <th style="width: 40%">Groups</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-item>
                            <tr [pSelectableRow]="item">
                                <td class="w-8rem">{{ item.id }}</td>
                                <td>{{ item.name }}</td>
                                <td class="flex flex-row flex-wrap gap-1 max-w-16rem">
                                    <p-tag *ngFor="let item of item.groups" severity="success" [value]="item" />
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabPanel>
        </p-tabView>
    </div>
</div>
<div class="grid px-2 relative">
    <div class="col-12 flex align-items-start justify-content-center gap-1 py-0" style="height: 32px;">
        <span class="text-overflow-scroll">{{ name ?? '-' }}</span>
        <p-tag *ngFor="let tag of tags" [severity]="tag.severity" [value]="tag.title" />
    </div>
    <p-tabView [style]="{height: '258px', width: '100vw'}">
        <p-tabPanel leftIcon="mdi mdi-information">
            <div class="grid pt-2 flex-row justify-content-center">
                <div class="col-12">
                    <div class="grid">
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.rightAscensionJ2000" />
                                <label>RA (J2000)</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.declinationJ2000" />
                                <label>DEC (J2000)</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.rightAscension" />
                                <label>RA</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.declination" />
                                <label>DEC</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.azimuth" />
                                <label>Azimuth</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.altitude" />
                                <label>Altitude</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full"
                                       [value]="bodyPosition.magnitude < 99 ? bodyPosition.magnitude.toFixed(2) : '-'" />
                                <label>Magnitude</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.constellation" />
                                <label>Constellation</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.distance" />
                                <label>Distance ({{ bodyPosition.distanceUnit }})</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.illuminated" />
                                <label>Illuminated (%)</label>
                            </span>
                        </div>
                        <div class="col-3">
                            <span class="p-float-label">
                                <input readonly pInputText class="p-inputtext-sm border-0 w-full" [value]="bodyPosition.elongation" />
                                <label>Elongation (°)</label>
                            </span>
                        </div>
                        <div class="col-3 text-center">
                            <p-button [disabled]="!name || refreshing" [text]="true" [rounded]="true" icon="mdi mdi-lg mdi-dots-vertical"
                                      (click)="ephemerisMenu.show()" />
                        </div>
                    </div>
                </div>
                <div class="col-12 flex justify-content-center">
                    <p-button [disabled]="!name || refreshing" [text]="true" severity="info" (onClick)="mountSync()" icon="mdi mdi-sync"
                              label="Sync" />
                    <p-button [disabled]="!name || refreshing" [text]="true" severity="success" (onClick)="mountGoTo()" icon="mdi mdi-telescope"
                              label="Go To" />
                    <p-button [disabled]="!name || refreshing" [text]="true" severity="success" (onClick)="mountSlew()" icon="mdi mdi-telescope"
                              label="Slew" />
                    <p-button [disabled]="!name || refreshing" [text]="true" (onClick)="frame()" icon="mdi mdi-image" label="Frame" />
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel leftIcon="mdi mdi-chart-bell-curve">
            <p-chart #chart width="100%" height="170px" [data]="altitudeData" [responsive]="true" [options]="altitudeOptions" />
        </p-tabPanel>
    </p-tabView>
</div>

<p-dialog header="Minor Planets" [modal]="true" [(visible)]="showMinorPlanetChoiceDialog" [style]="{width: '80vw'}">
    <div class="grid p-2">
        <p-listbox [options]="minorPlanetChoiceItems" (onChange)="minorPlanetChoosen($event)" [filter]="true" optionLabel="name"
                   [listStyle]="{ 'max-height': '250px' }" class="w-full" />
    </div>
</p-dialog>

<p-dialog header="Filter" [draggable]="false" [(visible)]="showSkyObjectFilter" [modal]="true" [style]="{width: '80vw'}">
    <div class="grid mt-2" *ngIf="skyObjectFilter">
        <div class="col-4">
            <span class="p-float-label">
                <input pInputText class="border-0 w-full" [value]="skyObjectFilter.rightAscension" />
                <label>RA (h)</label>
            </span>
        </div>
        <div class="col-4">
            <span class="p-float-label">
                <input pInputText class="border-0 w-full" [value]="skyObjectFilter.declination" />
                <label>DEC (°)</label>
            </span>
        </div>
        <div class="col-4">
            <span class="p-float-label">
                <p-inputNumber [min]="0" [max]="90" class="w-full" [showButtons]="true" inputStyleClass="border-0 w-full"
                               [(ngModel)]="skyObjectFilter.radius" />
                <label>Radius (°)</label>
            </span>
        </div>
        <div class="col-6">
            <span class="p-float-label">
                <p-dropdown [options]="constellationOptions" [(ngModel)]="skyObjectFilter.constellation" [filter]="true" appendTo="body"
                            styleClass="border-0">
                    <ng-template let-item pTemplate="selectedItem">
                        <div class="flex align-items-center gap-2">
                            <span>{{ item | enum }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                        <div class="flex align-items-center gap-2">
                            <span>{{ item | enum }}</span>
                        </div>
                    </ng-template>
                </p-dropdown>
                <label>Constellation</label>
            </span>
        </div>
        <div class="col-6">
            <span class="p-float-label">
                <p-dropdown [options]="skyObjectFilter.types" [(ngModel)]="skyObjectFilter.type" appendTo="body" [filter]="true"
                            styleClass="border-0">
                    <ng-template let-item pTemplate="selectedItem">
                        <div class="flex align-items-center gap-2">
                            <span>{{ item | enum }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                        <div class="flex align-items-center gap-2">
                            <span>{{ item | enum }}</span>
                        </div>
                    </ng-template>
                </p-dropdown>
                <label>Type</label>
            </span>
        </div>
        <div class="col-12">
            <p>Magnitude min: {{ skyObjectFilter.magnitude[0] }} max: {{ skyObjectFilter.magnitude[1] }}</p>
            <p-slider class="mt-3" [min]="-30" [max]="30" styleClass="mx-2" [(ngModel)]="skyObjectFilter.magnitude" [range]="true" />
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [disabled]="refreshing" [text]="true" icon="mdi mdi-filter" label="Filter" (onClick)="filterSkyObject()" />
    </ng-template>
</p-dialog>

<p-dialog header="Satellite Filter" [draggable]="false" [(visible)]="showSatelliteFilterDialog" [modal]="true" [style]="{width: '80vw'}">
    <div class="grid mt-2">
        <div class="col-12 flex flex-column gap-1 align-items-start flex-wrap">
            <ng-container *ngFor="let item of satelliteSearchGroup | keyvalue">
                <p-checkbox [binary]="true" [ngModel]="satelliteSearchGroup.get(item.key)"
                            (ngModelChange)="satelliteSearchGroup.set(item.key, $event)" [label]="item.key | enum" class="white-space-nowrap" />
            </ng-container>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button [disabled]="refreshing" [text]="true" severity="danger" icon="mdi mdi-restore" label="Reset" (onClick)="resetSatelliteFilter()" />
        <p-button [disabled]="refreshing" [text]="true" icon="mdi mdi-filter" label="Filter" (onClick)="filterSatellite()" />
    </ng-template>
</p-dialog>

<p-overlayPanel #calendarPanel [style]="{width: 'calc(100% - 8px)', marginLeft: '4px'}" appendTo="body">
    <ng-template pTemplate="content">
        <div class="grid">
            <div class="col-12 flex flex-row align-items-center justify-content-center gap-1">
                <p-inputSwitch [disabled]="refreshing" [(ngModel)]="useManualDateTime" (ngModelChange)="useManualDateTimeChanged()" />
            </div>
            <div class="col-12">
                <p-calendar [disabled]="refreshing || !useManualDateTime" [(ngModel)]="dateTime" (ngModelChange)="dateTimeChanged(true)"
                            [inline]="true" [showIcon]="true" [showWeek]="true" [showButtonBar]="false" dateFormat="yy-mm-dd" styleClass="w-full" />
            </div>
        </div>
        <div class="col-12 flex align-items-center justify-content-center gap-2">
            <p-inputNumber [disabled]="refreshing || !useManualDateTime" [(ngModel)]="dateTimeHour" [showButtons]="true" [min]="0" [max]="23"
                           class="w-fit" [format]="false" [allowEmpty]="false" (ngModelChange)="dateTimeChanged(false)"
                           styleClass="p-inputtext-sm border-0" [style]="{width: '54px'}" />
            <p-inputNumber [disabled]="refreshing || !useManualDateTime" [(ngModel)]="dateTimeMinute" [showButtons]="true" [min]="0" [max]="59"
                           class="w-fit" [format]="false" [allowEmpty]="false" (ngModelChange)="dateTimeChanged(false)"
                           styleClass="p-inputtext-sm border-0" [style]="{width: '54px'}" />
        </div>
    </ng-template>
</p-overlayPanel>

<p-dialogMenu #ephemerisMenu [model]="ephemerisModel" />
<p-deviceMenu #deviceMenu />