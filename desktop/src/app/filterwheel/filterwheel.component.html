<div class="container px-4 py-3">
	<div class="grid flex align-items-center">
		<div class="col-12 align-items-center gap-2">
			<neb-device-name [device]="wheel" />
			@if (wheel.connected) {
				<neb-button
					[disabled]="moving"
					(action)="connect()"
					icon="mdi mdi-close"
					severity="danger"
					tooltip="Disconnect" />
			} @else {
				<neb-button
					[disabled]="moving"
					(action)="connect()"
					icon="mdi mdi-connection"
					severity="info"
					tooltip="Connect" />
			}
			<neb-button-indi [device]="wheel" />
		</div>
		@if (canShowInfo) {
			<div class="col-12 pt-0 text-sm text-gray-400 flex align-items-center my-1 gap-1">
				<i class="mdi mdi-information text-info"></i>
				<span class="mr-3">{{ moving ? 'moving' : 'idle' }}</span>
				@if (wheel.connected && currentFilter) {
					@if (currentFilter.position) {
						<neb-tag label="#{{ currentFilter.position }}" />
					}
					<neb-info [label]="currentFilter.name" />
				}
			</div>
		}
	</div>
	<div class="grid mt-2">
		<div class="col-9">
			<ng-template
				#filterDropdownItem
				let-item
				let-selected="selected">
				<div class="flex flex-column justify-content-center gap-1">
					@let mItem = selected ? filter : item;

					<span
						class="flex align-items-center text-xs gap-1"
						style="min-height: 15px">
						@if (mItem) {
							<neb-tag label="#{{ mItem.position }}" />
							<neb-success label="OFFSET: {{ focusOffsetForFilter(mItem) }}" />
							@if (mItem.dark) {
								<i class="mdi mdi-camera-iris"></i>
							}
						}
					</span>
					<span>{{ mItem?.name }}</span>
				</div>
			</ng-template>
			<neb-dropdown
				label="Filter"
				[disabled]="!wheel.connected || moving"
				[options]="filters"
				[(value)]="filter"
				(valueChange)="filterChanged()"
				emptyMessage="No filter available"
				[itemTemplate]="filterDropdownItem" />
		</div>
		<div class="col-3 flex align-items-center justify-content-center">
			<neb-button
				[disabled]="!canMoveTo || !wheel.connected || moving || filter?.position === position"
				label="Move"
				icon="mdi mdi-check"
				(action)="moveToSelectedFilter()" />
		</div>
	</div>
	@if (filter) {
		@if (canEdit) {
			<div class="grid mt-2">
				<div class="col-8">
					<neb-input-text
						label="Name"
						[disabled]="!wheel.connected || moving"
						[maxLength]="16"
						[(value)]="filter.name"
						(valueChange)="filterNameChanged(filter)" />
				</div>
				<div class="col-4 flex flex-column justify-content-center gap-2">
					<neb-checkbox
						[disabled]="!wheel.connected || moving"
						[value]="filter.dark"
						(valueChange)="shutterToggled(filter, $event)"
						label="Shutter" />
				</div>
			</div>
		}
		<div class="grid mt-1">
			<div class="col-12 flex align-items-center justify-content-between gap-2">
				<neb-device-chooser
					title="FOCUSER"
					icon="mdi mdi-image-filter-center-focus"
					[disabled]="!canChangeFocusOffset"
					[devices]="focusers"
					[(device)]="focuser"
					(deviceChange)="focuserChanged()"
					(deviceConnect)="focuserChanged()"
					style="max-width: 60%" />
				<neb-input-number
					label="Focus offset"
					[disabled]="!wheel.connected || moving || !focuser?.connected || !canChangeFocusOffset"
					[min]="focuserMinPosition"
					[max]="focuserMaxPosition"
					[(value)]="focuserOffset"
					(valueChange)="focusOffsetChanged()" />
			</div>
		</div>
	}
	@if (canApply) {
		<div class="grid mt-2">
			<div class="col-12 flex justify-content-center gap-2">
				<neb-button
					[disabled]="!wheel.connected || !filter || !filters.length"
					label="Save"
					(action)="apply()"
					icon="mdi mdi-content-save"
					severity="info" />
			</div>
		</div>
	}
</div>
