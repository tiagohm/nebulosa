<div class="container px-4 pt-4">
    <div class="grid flex justify-content-center align-items-center">
        <div class="col-6 px-0">
            <span class="p-float-label">
                <p-dropdown [disabled]="connected" [options]="lastConnectedHosts" [ngModel]="connection" [editable]="true" optionLabel="host"
                            styleClass="border-0 p-inputtext-sm w-full" (ngModelChange)="hostChanged($event)"
                            [autoDisplayFirst]="false" emptyMessage="No connection found">
                    <ng-template let-item pTemplate="selectedItem">
                        <div class="flex flex-row justify-content-between gap-1">
                            <span>{{ item.host }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                        <div class="flex flex-column gap-1">
                            <div class="flex flex-row justify-content-between gap-1">
                                <span class="font-bold text-sm">{{ item.host }}:{{ item.port }}</span>
                                <i class="mdi mdi-close" pTooltip="Remove" tooltipPosition="bottom" (click)="removeConnection(item, $event)"></i>
                            </div>
                            <div class="flex flex-row align-items-center gap-1 text-xs">
                                <i class="mdi mdi-sm mdi-clock"></i>
                                <span>{{ item.connectedAt | date:'yyyy-MM-dd HH:mm:ss' }}</span>
                            </div>
                        </div>
                    </ng-template>
                </p-dropdown>
                <label>{{ connection.type }} Host</label>
            </span>
        </div>
        <div class="col-6 gap-2">
            <span class="p-float-label" style="min-width: 80px;">
                <p-inputNumber [disabled]="connected" [showButtons]="true" styleClass="border-0 p-inputtext-sm w-full" placeholder="7624"
                               [(ngModel)]="connection.port" [format]="false" />
                <label>Port</label>
            </span>
            <p-button *ngIf="connected" (onClick)="connect()" size="small" icon="mdi mdi-close" severity="danger" />
            <p-splitButton *ngIf="!connected" [model]="connectionTypeModel" icon="mdi mdi-connection" size="small" severity="info"
                           (onClick)="connect()" />
        </div>
    </div>
    <div class="grid mt-2 overflow-y-auto" style="max-height: calc(100vh - 112px);">
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasCamera" (onClick)="open('CAMERA')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/camera.png" />
                <div class="mt-1 text-sm">Camera</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasMount" (onClick)="open('MOUNT')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/telescope.png" />
                <div class="mt-1 text-sm">Mount</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasGuider" (onClick)="open('GUIDER')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/guider.png" />
                <div class="mt-1 text-sm">Guider</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasWheel" (onClick)="open('WHEEL')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/filter-wheel.png" />
                <div class="mt-1 text-sm">Filter Wheel</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasFocuser" (onClick)="open('FOCUSER')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/focus.png" />
                <div class="mt-1 text-sm">Focuser</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasRotator" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/rotate.png" />
                <div class="mt-1 text-sm">Rotator</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasDome" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/observatory.png" />
                <div class="mt-1 text-sm">Dome</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasSwitch" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/switch.png" />
                <div class="mt-1 text-sm">Switch</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('SKY_ATLAS')" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/atlas.png" />
                <div class="mt-1 text-sm">Sky Atlas</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasAlignment" (onClick)="open('ALIGNMENT')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/star.png" />
                <div class="mt-1 text-sm">Alignment</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('SEQUENCER')" [disabled]="!connected || !hasSequencer"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/sequencer.png" />
                <div class="mt-1 text-sm">Sequencer</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('IMAGE')" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/image.png" />
                <div class="mt-1 text-sm">Image Viewer</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('FRAMING')" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/framing.png" />
                <div class="mt-1 text-sm">Framing</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('FLAT_WIZARD')" [disabled]="!connected || !hasFlatWizard"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/flat-wizard.png" />
                <div class="mt-1 text-sm">Flat Wizard</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" [disabled]="!connected || !hasINDI" (onClick)="open('INDI')"
                      styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/indi.png" />
                <div class="mt-1 text-sm">INDI</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('SETTINGS')" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/settings.png" />
                <div class="mt-1 text-sm">Settings</div>
            </p-button>
        </div>
        <div class="col-4 p-1">
            <p-button [text]="true" (onClick)="open('ABOUT')" styleClass="open min-w-full w-full px-1 py-2 flex-column">
                <img src="assets/icons/about.png" />
                <div class="mt-1 text-sm">About</div>
            </p-button>
        </div>
    </div>
</div>

<neb-dialog-menu #deviceMenu [model]="deviceModel" />
<neb-device-list-menu #imageMenu [model]="imageModel" [disableIfNotConnected]="false" />