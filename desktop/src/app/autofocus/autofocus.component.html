<div class="grid p-4">
	<div class="col-12 align-items-center justify-content-center gap-2">
		<neb-device-chooser
			title="CAMERA"
			icon="mdi mdi-camera-iris"
			[devices]="cameras"
			[(device)]="camera"
			(deviceChange)="cameraChanged()" />
		<neb-button
			[disabled]="!camera?.name || running"
			icon="mdi mdi-cog"
			(action)="showCameraDialog()"
			tooltip="Camera" />
		<neb-device-chooser
			title="FOCUSER"
			icon="mdi mdi-target"
			[devices]="focusers"
			[(device)]="focuser"
			(deviceChange)="focuserChanged()" />
	</div>
	<div class="col-12 justify-content-center align-items-center">
		<neb-camera-info
			[info]="request.capture"
			[hasType]="false" />
	</div>
	<div
		class="col-12 relative pt-0 text-sm text-gray-400 flex align-items-center mt-1 gap-1 text-sm"
		style="min-height: 25px">
		<neb-camera-exposure
			#cameraExposure
			[info]="status" />
	</div>
	<div class="col-12 pb-0">
		<div class="col-3 align-items-center">
			<neb-input-text
				label="Position"
				[readonly]="true"
				[value]="focuser?.position ?? 0" />
		</div>
		<div class="col-3 align-items-center">
			<neb-input-text
				label="Star Count"
				[readonly]="true"
				[value]="starCount" />
		</div>
		<div class="col-3 align-items-center">
			<neb-input-text
				label="HFD"
				[readonly]="true"
				[value]="starHFD.toFixed(2)" />
		</div>
	</div>
	<div class="col-12 pt-0">
		<p-tabView>
			<p-tabPanel
				header="Parameters"
				leftIcon="mdi mdi-wrench">
				<div class="grid mt-3">
					<div class="col-4 align-items-center">
						<neb-input-number
							label="Step Size"
							[disabled]="!focuser?.connected"
							[min]="1"
							[max]="focuser?.maxPosition ?? 1"
							[(value)]="request.stepSize"
							(valueChange)="savePreference()" />
					</div>
					<div class="col-5 align-items-center">
						<neb-input-number
							label="Initial Offset Steps ({{ request.initialOffsetSteps * request.stepSize }})"
							[disabled]="!focuser?.connected"
							[min]="1"
							[max]="1000"
							[(value)]="request.initialOffsetSteps"
							(valueChange)="savePreference()" />
					</div>
					<div class="col-5 align-items-center">
						<neb-dropdown-enum
							label="Curve Fitting"
							[options]="'CURVE_FITTING_MODE' | dropdownOptions"
							[(value)]="request.fittingMode"
							(valueChange)="savePreference()" />
					</div>
					<div class="col-4 align-items-center">
						<neb-dropdown-enum
							label="Star Detector"
							[options]="'STAR_DETECTOR' | dropdownOptions"
							[(value)]="request.starDetector.type"
							(valueChange)="savePreference()" />
					</div>
					<div class="col-3">
						<neb-input-number
							label="R-Squared"
							[min]="0"
							[max]="1"
							[step]="0.1"
							[(value)]="request.rSquaredThreshold"
							(valueChange)="savePreference()" />
					</div>
					<div class="col-10">
						<div class="grid">
							<div class="col-6 align-items-center">
								<neb-dropdown-enum
									label="Backlash Compensation"
									[options]="'BACKLASH_COMPENSATION_MODE' | dropdownOptions"
									[(value)]="request.backlashCompensation.mode"
									(valueChange)="savePreference()" />
							</div>
							<div class="col-3 align-items-center">
								<neb-input-number
									label="In"
									[disabled]="request.backlashCompensation.mode === 'NONE'"
									[min]="0"
									[max]="1000"
									[(value)]="request.backlashCompensation.backlashIn"
									(valueChange)="savePreference()" />
							</div>
							<div class="col-3 align-items-center">
								<neb-input-number
									label="Out"
									[disabled]="request.backlashCompensation.mode === 'NONE'"
									[min]="0"
									[max]="1000"
									[(value)]="request.backlashCompensation.backlashOut"
									(valueChange)="savePreference()" />
							</div>
						</div>
					</div>
				</div>
			</p-tabPanel>
			<p-tabPanel
				header="Chart"
				leftIcon="mdi mdi-chart-bell-curve">
				<div class="col-12">
					<p-chart
						#chart
						width="100%"
						height="130.5px"
						[data]="chartData"
						[responsive]="true"
						[options]="chartOptions" />
				</div>
			</p-tabPanel>
		</p-tabView>
	</div>
	<div class="col-12 flex align-items-center justify-content-center gap-1">
		<neb-button
			[disabled]="!camera?.connected || !focuser?.connected || running"
			label="Start"
			(action)="start()"
			icon="mdi mdi-play"
			severity="success" />
		<neb-button
			[disabled]="!camera?.connected || !focuser?.connected || !running"
			label="Abort"
			(action)="stop()"
			icon="mdi mdi-stop"
			severity="danger" />
		<neb-button
			[disabled]="!camera?.connected"
			(action)="openCameraImage()"
			icon="mdi mdi-image"
			class="ml-4"
			tooltip="View image"
			tooltipPosition="top" />
	</div>
</div>
